<!-- HTML header for doxygen 1.8.11-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>TOS API: kernel/process.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">TOS API
   </div>
  </td>
  <td style="padding-left: 10em;">
    <div ><a href="http://tos.sfsu.edu" style="font-size: 150%;">TOS Web Site</a> </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_dc43877d82dd332f9fb2071fcca799d6.html">kernel</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">process.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;<a class="el" href="kernel_8h.html">kernel.h</a>&gt;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a1ba4e1733cef92f340ccca9e2c306b7a"><td class="memItemLeft" align="right" valign="top"><a class="el" href="kernel_8h.html#a6dde884e19bdc8f342ffec8fc17e7c91">PORT</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="process_8c.html#a1ba4e1733cef92f340ccca9e2c306b7a">create_process</a> (void(*ptr_to_new_proc)(<a class="el" href="kernel_8h.html#a831d87f38811800ce0698bbe85e6b386">PROCESS</a>, <a class="el" href="kernel_8h.html#a83f26503eb4a201692c1e8d8bb2e168d">PARAM</a>), int prio, <a class="el" href="kernel_8h.html#a83f26503eb4a201692c1e8d8bb2e168d">PARAM</a> param, char *name)</td></tr>
<tr class="memdesc:a1ba4e1733cef92f340ccca9e2c306b7a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Creates a new TOS process and returns the PORT owned by the new process (or, before PORTs are covered, returns a NULL pointer).  <a href="#a1ba4e1733cef92f340ccca9e2c306b7a">More...</a><br /></td></tr>
<tr class="separator:a1ba4e1733cef92f340ccca9e2c306b7a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0ba03cb110510187d40043ffd1352d57"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="process_8c.html#a0ba03cb110510187d40043ffd1352d57">print_process</a> (<a class="el" href="structWINDOW.html">WINDOW</a> *wnd, <a class="el" href="kernel_8h.html#a831d87f38811800ce0698bbe85e6b386">PROCESS</a> p)</td></tr>
<tr class="memdesc:a0ba03cb110510187d40043ffd1352d57"><td class="mdescLeft">&#160;</td><td class="mdescRight">Creates and returns a copy of the calling process.  <a href="#a0ba03cb110510187d40043ffd1352d57">More...</a><br /></td></tr>
<tr class="separator:a0ba03cb110510187d40043ffd1352d57"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae816c773af94e99847e12d847fe1b252"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="process_8c.html#ae816c773af94e99847e12d847fe1b252">print_all_processes</a> (<a class="el" href="structWINDOW.html">WINDOW</a> *wnd)</td></tr>
<tr class="memdesc:ae816c773af94e99847e12d847fe1b252"><td class="mdescLeft">&#160;</td><td class="mdescRight">Prints the details of all existing TOS processes.  <a href="#ae816c773af94e99847e12d847fe1b252">More...</a><br /></td></tr>
<tr class="separator:ae816c773af94e99847e12d847fe1b252"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab25d44702b6e10e723714c368c4a7520"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="process_8c.html#ab25d44702b6e10e723714c368c4a7520">init_process</a> ()</td></tr>
<tr class="memdesc:ab25d44702b6e10e723714c368c4a7520"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initializes the global variables associated with TOS process creation.  <a href="#ab25d44702b6e10e723714c368c4a7520">More...</a><br /></td></tr>
<tr class="separator:ab25d44702b6e10e723714c368c4a7520"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:aa13757c49c1256b766ebc3d259ed94a3"><td class="memItemLeft" align="right" valign="top"><a class="el" href="kernel_8h.html#a5350bbf84ca71e7d5e966feef1a70578">PCB</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="process_8c.html#aa13757c49c1256b766ebc3d259ed94a3">pcb</a> [<a class="el" href="kernel_8h.html#a0e92bfcd9e51ca39bbebc3dfb9c16014">MAX_PROCS</a>]</td></tr>
<tr class="memdesc:aa13757c49c1256b766ebc3d259ed94a3"><td class="mdescLeft">&#160;</td><td class="mdescRight">An array of twenty PCB structs.  <a href="#aa13757c49c1256b766ebc3d259ed94a3">More...</a><br /></td></tr>
<tr class="separator:aa13757c49c1256b766ebc3d259ed94a3"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="a1ba4e1733cef92f340ccca9e2c306b7a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="kernel_8h.html#a6dde884e19bdc8f342ffec8fc17e7c91">PORT</a> create_process </td>
          <td>(</td>
          <td class="paramtype">void(*)(<a class="el" href="kernel_8h.html#a831d87f38811800ce0698bbe85e6b386">PROCESS</a>, <a class="el" href="kernel_8h.html#a83f26503eb4a201692c1e8d8bb2e168d">PARAM</a>)&#160;</td>
          <td class="paramname"><em>new_proc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>prio</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="kernel_8h.html#a83f26503eb4a201692c1e8d8bb2e168d">PARAM</a>&#160;</td>
          <td class="paramname"><em>param</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>proc_name</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Creates a new TOS process and returns the PORT owned by the new process (or, before PORTs are covered, returns a NULL pointer). </p>
<p>When the running process calls this function, a new TOS process is created through the following steps: (1) The next available PCB entry in the pcb[] array is allocated; (2) the elements of this PCB entry are initialized (see the lecture slide on create_process for a full description); (3) an available 16kb stack frame for this process is allocated; (4) the newly-allocated stack frame is initialized (see the lecture slide describing how this function populates the stack); (5) the stack pointer is saved to the PCB.esp field for this PCB entry; (6) the new process is added to the ready queue (but note that <a class="el" href="kernel_8h.html#aaae42c37d7e61697646625aafaeae957" title="Implements a context switch in TOS, giving another process a chance to run. ">resign()</a> is not called, and that the new process does not start running immediately); (7) return either a null pointer (before the class covers ports) or the PORT of the new process. Note that the implementation of <a class="el" href="kernel_8h.html#ae982573084c63244f2b0c4f8acb043f7" title="Creates a new TOS process and returns the PORT owned by the new process (or, before PORTs are covered...">create_process()</a> will change slightly once interrupts are introduced, later in the course. See the "Preemptive Multitasking" slide deck for more information at the appropriate time in the course. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">new_proc</td><td>Function pointer to a C function that takes a PROCESS and a PARAM as input arguments and returns void. This function pointer new_proc serves as the entry point for the newly-created TOS process </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">prio</td><td>Integer specifying the priority of this new process </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">param</td><td>A parameter to be passed in to the new process and placed on the new process's stack frame </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">name</td><td>Pointer to the first element of a character array that indicates the name of the new process </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>PORT The port owned by the newly-created process. </dd></dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="kernel_8h.html#a6dde884e19bdc8f342ffec8fc17e7c91" title="This typedef creates the alternative name PORT for a pointer to a _PORT_DEF struct. ">PORT</a>, <a class="el" href="kernel_8h.html#a83f26503eb4a201692c1e8d8bb2e168d" title="A typedef that creates the alternative name PARAM for an unsigned integer type. ">PARAM</a>, <a class="el" href="kernel_8h.html#a831d87f38811800ce0698bbe85e6b386" title="Pointer to a _PCB struct, also known as a PCB. ">PROCESS</a>, <a class="el" href="kernel_8h.html#a5350bbf84ca71e7d5e966feef1a70578" title="A typedef that creates PCB as an alternative name for the data type of _PCB struct. ">PCB</a>, <a class="el" href="kernel_8h.html#a5e64f2ad93cc9de92000f884e6e0a8a9" title="An array of twenty PCB structs. ">pcb</a>, <a class="el" href="struct__PORT__DEF.html" title="A data structure that holds the members associated with a TOS process&#39;s port, used for inter-process ...">_PORT_DEF</a>, <a class="el" href="kernel_8h.html#a5d4f5821d92bb871d64da5a1290516f9" title="A typedef for a data structure which describes a PORT. ">PORT_DEF</a> </dd></dl>

</div>
</div>
<a class="anchor" id="ab25d44702b6e10e723714c368c4a7520"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void init_process </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initializes the global variables associated with TOS process creation. </p>
<p>This function clears all the entries in the pcb[] array; prepares the doubly-linked list of entries so that each pcb entry contains the address of the next available PCB slot; prepares the pcb entry for the boot process, and sets the global variable active_proc (used throughout TOS) to the first entry of the pcb array. </p><dl class="section see"><dt>See also</dt><dd><a class="el" href="kernel_8h.html#a5e64f2ad93cc9de92000f884e6e0a8a9" title="An array of twenty PCB structs. ">pcb</a>, <a class="el" href="kernel_8h.html#a5350bbf84ca71e7d5e966feef1a70578" title="A typedef that creates PCB as an alternative name for the data type of _PCB struct. ">PCB</a>, <a class="el" href="kernel_8h.html#a831d87f38811800ce0698bbe85e6b386" title="Pointer to a _PCB struct, also known as a PCB. ">PROCESS</a> </dd></dl>

</div>
</div>
<a class="anchor" id="ae816c773af94e99847e12d847fe1b252"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void print_all_processes </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structWINDOW.html">WINDOW</a> *&#160;</td>
          <td class="paramname"><em>wnd</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Prints the details of all existing TOS processes. </p>
<p>The name, state, and priority of each existing TOS process is printed, with a special character (e.g., an asterisk) indicating if the process is currently the running process. See the lecture slides on TOS processes for an example of how the output may look like. One possible implementation of this function calls <a class="el" href="kernel_8h.html#a0ba03cb110510187d40043ffd1352d57" title="Creates and returns a copy of the calling process. ">print_process()</a> for each of the processes in the PCB array. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">wnd</td><td>Pointer to the <a class="el" href="structWINDOW.html" title="Struct that holds properties of a specific window. ">WINDOW</a> to which the process details should be printed </td></tr>
  </table>
  </dd>
</dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="kernel_8h.html#a0ba03cb110510187d40043ffd1352d57" title="Creates and returns a copy of the calling process. ">print_process()</a>, <a class="el" href="kernel_8h.html#a5e64f2ad93cc9de92000f884e6e0a8a9" title="An array of twenty PCB structs. ">pcb</a>, <a class="el" href="kernel_8h.html#a5350bbf84ca71e7d5e966feef1a70578" title="A typedef that creates PCB as an alternative name for the data type of _PCB struct. ">PCB</a> </dd></dl>

</div>
</div>
<a class="anchor" id="a0ba03cb110510187d40043ffd1352d57"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void print_process </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structWINDOW.html">WINDOW</a> *&#160;</td>
          <td class="paramname"><em>wnd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="kernel_8h.html#a831d87f38811800ce0698bbe85e6b386">PROCESS</a>&#160;</td>
          <td class="paramname"><em>p</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Creates and returns a copy of the calling process. </p>
<p>This function initializes a new TOS process to be an exact copy of the calling process. The program code, heap, and stack are all copied. The new process occupies a different PCB entry and has a different stack frame than the calling process and is in fact a distinct process from the calling process. </p><dl class="section see"><dt>See also</dt><dd><a class="el" href="kernel_8h.html#ae982573084c63244f2b0c4f8acb043f7" title="Creates a new TOS process and returns the PORT owned by the new process (or, before PORTs are covered...">create_process()</a>, <a class="el" href="kernel_8h.html#a5350bbf84ca71e7d5e966feef1a70578" title="A typedef that creates PCB as an alternative name for the data type of _PCB struct. ">PCB</a>, <a class="el" href="kernel_8h.html#a5e64f2ad93cc9de92000f884e6e0a8a9" title="An array of twenty PCB structs. ">pcb</a></dd></dl>
<p>Prints the details of the specified TOS process</p>
<p>The name, state, and priority of the TOS process is printed, with a special character (e.g., an asterisk) indicating if the process is currently the running process. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">wnd</td><td>Pointer to the <a class="el" href="structWINDOW.html" title="Struct that holds properties of a specific window. ">WINDOW</a> to which the process details should be printed </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">p</td><td>The process whose details should be printed. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="kernel_8h.html#ae816c773af94e99847e12d847fe1b252" title="Prints the details of all existing TOS processes. ">print_all_processes()</a> </dd></dl>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a class="anchor" id="aa13757c49c1256b766ebc3d259ed94a3"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="kernel_8h.html#a5350bbf84ca71e7d5e966feef1a70578">PCB</a> pcb[<a class="el" href="kernel_8h.html#a0e92bfcd9e51ca39bbebc3dfb9c16014">MAX_PROCS</a>]</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>An array of twenty PCB structs. </p>
<p>Each element in this array corresponds to the PCB entry for one TOS process. TOS processes are never removed from this array: when a process has completed its task, its state becomes <a class="el" href="kernel_8h.html#a8e13ad68fa4d5752084a5ef0e0085a66" title="This state is assigned to processes that are permanently off the ready queue and will never run again...">STATE_ZOMBIE</a> and it remains in the PCB array. </p><dl class="section see"><dt>See also</dt><dd><a class="el" href="kernel_8h.html#ae982573084c63244f2b0c4f8acb043f7" title="Creates a new TOS process and returns the PORT owned by the new process (or, before PORTs are covered...">create_process()</a>, <a class="el" href="struct__PCB.html" title="Struct that holds the information associated with a TOS process. ">_PCB</a> </dd></dl>

</div>
</div>
</div><!-- contents -->
<!-- HTML footer for doxygen 1.8.11-->
<!-- start footer part -->
<!--
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
-->
</body>
</html>
